#!/bin/bash

# ๐ ุณูุฑูุจุช ุงูุชุดุบูู ุงูุณุฑูุน ูุจูุช ุฑูุน ุฌูุฏุฉ ุงูุตูุฑ

echo "๐จ ุจูุช ุชูููุฌุฑุงู ูุฑูุน ุฌูุฏุฉ ุงูุตูุฑ ุฅูู 4K"
echo "=========================================="
echo ""

# ุงูุชุญูู ูู Python
if ! command -v python3 &> /dev/null; then
    echo "โ Python 3 ุบูุฑ ูุซุจุช. ูุฑุฌู ุชุซุจูุชู ุฃููุงู."
    exit 1
fi

echo "โ Python ูุซุจุช"
echo ""

# ุฅูุดุงุก ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ
if [ ! -d "venv" ]; then
    echo "๐ฆ ุฅูุดุงุก ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ..."
    python3 -m venv venv
    echo "โ ุชู ุฅูุดุงุก ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ"
else
    echo "โ ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ ููุฌูุฏุฉ"
fi

echo ""

# ุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ
echo "โก๏ธ ุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ..."
source venv/bin/activate

# ุชุซุจูุช ุงููุชุทูุจุงุช
echo "๐ ุชุซุจูุช ุงูููุชุจุงุช ุงููุทููุจุฉ..."
pip install -q -r requirements.txt

echo "โ ุชู ุชุซุจูุช ุฌููุน ุงููุชุทูุจุงุช"
echo ""

# ุงูุชุญูู ูู ููู .env
if [ ! -f ".env" ]; then
    echo "โ๏ธ  ููู .env ุบูุฑ ููุฌูุฏ"
    echo "๐ ุฅูุดุงุก ููู .env ูู ุงููุซุงู..."
    cp .env.example .env
    echo ""
    echo "โ๏ธ ูุฑุฌู ุชุนุฏูู ููู .env ูุฅุถุงูุฉ:"
    echo "   1. BOT_TOKEN ูู @BotFather"
    echo "   2. API_KEY ูู ClipDrop"
    echo ""
    echo "ุซู ุดุบูู ูุฐุง ุงูุณูุฑูุจุช ูุฑุฉ ุฃุฎุฑู"
    exit 1
fi

echo "โ ููู .env ููุฌูุฏ"
echo ""

# ุงูุชุญูู ูู ูุฌูุฏ BOT_TOKEN
if ! grep -q "BOT_TOKEN=.\+" .env; then
    echo "โ BOT_TOKEN ุบูุฑ ููุฌูุฏ ูู ููู .env"
    echo "ูุฑุฌู ุฅุถุงูุฉ ุงูุชููู ูู @BotFather"
    exit 1
fi

echo "โ BOT_TOKEN ููุฌูุฏ"
echo ""

# ุชุดุบูู ุงูุจูุช
echo "๐ ุชุดุบูู ุงูุจูุช..."
echo "=========================================="
echo ""

python main.py
